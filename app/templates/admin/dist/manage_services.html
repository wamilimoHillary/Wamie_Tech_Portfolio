{% extends "admin/admin_base.html" %}

{% block title %}Service Management{% endblock %}

{% block styles %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/colors.css') }}">
<link rel="stylesheet" href="{{ url_for('static', filename='css/user_management.css') }}">
<link rel="stylesheet" href="{{ url_for('static', filename='css/admin_forms.css') }}">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
<link href="https://fonts.googleapis.com/css2?family=Roboto+Slab:wght@400;700&family=Dancing+Script:wght@400;700&display=swap" rel="stylesheet">
{% endblock %}

{% block admin_content %}
<div class="admin-container" style="margin:5px;">
  <section class="user-management">
    <h2>Service Management</h2>
    
<div class="add-btn-container">
        <button id="add-service-btn" class="add-btn"><i class="fas fa-plus"></i> Add Service</button>
      </div>


    <div class="wrap-items">
      <div class="user-search-bar">
        <form method="GET">
          <input type="text" id="search-bar" name="search" placeholder="Search services by name or price...">
          <button type="submit" class="search-btn">Search</button>
        </form>
      </div>

      
    </div>

    <!-- Flash Messages -->
    {% with messages = get_flashed_messages(with_categories=true) %}
    {% if messages %}
    <div class="flash-messages">
      {% for category, message in messages %}
      <div class="flash {{ category }}">{{ message }}</div>
      {% endfor %}
    </div>
    {% endif %}
    {% endwith %}

    <!-- Services Table -->
    <table class="user-table">
      <thead>
        <tr>
          <th>No</th>
          <th>Service Name</th>
          <th>Description</th>
          <th>Price</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        {% for service in services %}
        <tr>
          <td>{{ loop.index }}</td>
          <td>{{ service[1] }}</td>
          <td>{{ service[2] }}</td>
          <td>{{ service[3] }}</td>
          <td class="action">
            <button class="edit-btn"
                    data-id="{{ service[0] }}"
                    data-name="{{ service[1] }}"
                    data-description="{{ service[2] }}"
                    data-price="{{ service[3] }}">
              <i class="fas fa-edit"></i> Edit
            </button>
            <button class="delete-btn"
                    data-id="{{ service[0] }}"
                    onclick="openDeleteModal('{{ service[0] }}')">
              <i class="fas fa-trash"></i> Delete
            </button>
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </section>
</div>

<!-- Add Service Modal -->
<div id="add-service-modal" class="modal">
  <div class="modal-content">
    <span class="close-btn">&times;</span>
    <h2 class="form-title">Add Service</h2>
    <form action="{{ url_for('admin.add_service') }}" method="POST" class="form">
      <div class="form-group">
        <label class="form-label" for="add-service-name">Service Name</label>
        <input type="text" name="service_name" id="add-service-name" class="form-input" required>
      </div>
      <div class="form-group">
        <label class="form-label" for="add-service-description">Description</label>
        <textarea name="service_description" id="add-service-description" class="form-input" required></textarea>
      </div>
      <div class="form-group">
        <label class="form-label" for="add-service-price">Price</label>
        <input type="number" name="service_price" id="add-service-price" class="form-input" required>
      </div>
      <button type="submit" class="form-button">Add Service</button>
    </form>
  </div>
</div>

<!-- Edit Service Modal -->
<div id="update-service-modal" class="modal">
  <div class="modal-content">
    <span class="close-btn">&times;</span>
    <h2 class="form-title">Edit Service</h2>
    <form action="{{ url_for('admin.update_service') }}" method="POST" class="form">
      <input type="hidden" name="service_id" id="service-id">
      <div class="form-group">
        <label class="form-label" for="service-name">Service Name</label>
        <input type="text" name="service_name" id="service-name" class="form-input" required>
      </div>
      <div class="form-group">
        <label class="form-label" for="service-description">Description</label>
        <textarea name="service_description" id="service-description" class="form-input" required></textarea>
      </div>
      <div class="form-group">
        <label class="form-label" for="service-price">Price</label>
        <input type="number" name="service_price" id="service-price" class="form-input" required>
      </div>
      <button type="submit" class="form-button">Update</button>
    </form>
  </div>
</div>

<!-- Delete Service Modal -->
<div id="delete-service-modal" class="modal">
  <div class="modal-content">
    <span class="close-btn">&times;</span>
    <h2 class="form-title">Confirm Delete</h2>
    <p>Are you sure you want to delete this service?</p>
    <form action="{{ url_for('admin.delete_service') }}" method="POST" class="form">
      <input type="hidden" name="service_id" id="delete-service-id">
      <button type="submit" class="form-button danger">Delete</button>
      <button type="button" class="form-button" onclick="closeDeleteModal()">Cancel</button>
    </form>
  </div>
</div>
{% endblock %}

{% block scripts %}
<script>
/* ================================
   🎯 Modal + Form Interactions
   ================================ */
document.querySelectorAll('.edit-btn').forEach(button => {
  button.addEventListener('click', function() {
    const modal = document.getElementById('update-service-modal');
    modal.classList.add('show');
    document.getElementById('service-id').value = this.dataset.id;
    document.getElementById('service-name').value = this.dataset.name;
    document.getElementById('service-description').value = this.dataset.description;
    document.getElementById('service-price').value = this.dataset.price;
  });
});

function openDeleteModal(id) {
  document.getElementById('delete-service-id').value = id;
  document.getElementById('delete-service-modal').classList.add('show');
}

function closeDeleteModal() {
  document.getElementById('delete-service-modal').classList.remove('show');
}

document.querySelectorAll('.close-btn').forEach(btn => {
  btn.addEventListener('click', () => btn.closest('.modal').classList.remove('show'));
});

window.addEventListener('click', e => {
  document.querySelectorAll('.modal').forEach(m => {
    if (e.target === m) m.classList.remove('show');
  });
});

document.getElementById('add-service-btn').addEventListener('click', () => {
  document.getElementById('add-service-modal').classList.add('show');
});

/* ================================
   🔍 Live Search (Instant Filter)
   ================================ */
const searchInput = document.getElementById('search-bar');
const tableBody = document.querySelector('.user-table tbody');

searchInput.addEventListener('input', function() {
  const filter = this.value.trim().toLowerCase();
  const rows = tableBody.querySelectorAll('tr');
  rows.forEach(row => {
    const cells = row.querySelectorAll('td');
    let matchFound = false;
    cells.forEach(cell => {
      if (cell.textContent.trim().toLowerCase().includes(filter)) {
        matchFound = true;
      }
    });
    row.style.display = matchFound ? '' : 'none';
  });
});
</script>
{% endblock %}
