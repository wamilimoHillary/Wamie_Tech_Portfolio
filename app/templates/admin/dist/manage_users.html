<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>User Management</title>
    
    <!-- Link to login-specific CSS -->
    <link rel="stylesheet" href="{{ url_for('static', filename='css/admin_dashboard.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/admin_forms.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/colors.css') }}">

     <!-- Link for Google Material Icons -->
     <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
     <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
 
      <!--link to font family-->
      <link href="https://fonts.googleapis.com/css2?family=Roboto+Slab:wght@400;700&family=Dancing+Script:wght@400;700&display=swap" rel="stylesheet">
  
</head>
<body style="margin:5px;">
    <div class="admin-container">
        <!-- User Management Section -->
        <section class="user-management">
            <h2>User Management</h2>

            <div class="wrap-items">
                    <!-- Back to Admin Dashboard Link -->
                    <div class="back-to-dashboard">
                        <a href="{{ url_for('admin.admin_dashboard') }}" class="back-link">
                            <i class="fas fa-arrow-left"></i> Back to Dashboard
                        </a>
                    </div>

                    <!-- Search Users -->
                    <div class="user-search-bar">
                        <form  method="GET">
                            <input type="text" id="search-bar" name="search" placeholder="Search users by name or email...">
                            <button type="submit" class="search-btn">Search</button>
                        </form>
                    </div>
            </div>

            
        <!-- Display Flash Messages -->
        {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
            <div class="flash-messages">
                {% for category, message in messages %}
                    <div class="flash {{ category }}">{{ message }}</div>
                {% endfor %}
            </div>
        {% endif %}
        {% endwith %}
           
            <!-- Users Table -->
            <table class="user-table">
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>Username</th>
                        <th>Email</th>
                        <th>Phone</th>
                        <th>Status</th>
                        <th>Created At</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    {% for user in users %}
                    <tr>
                        <td>{{ user[0] }}</td>
                        <td>{{ user[1] }}</td>
                        <td>{{ user[2] }}</td>
                        <td>{{ user[3] }}</td>
                        <td>{{ user[5] }}</td>
                        <td>{{ user[7] }}</td>
                        <td class="action">
                            <!--edit action-->
                            <button class="edit-btn" data-id="{{ user[0] }}" data-username="{{ user[1] }}" data-email="{{ user[2] }}" 
                                data-phone="{{ user[3] }}" data-status="{{ user[5] }}"><i class="fas fa-edit"></i>Edit</button>
                            <!--delete action-->
                            <button class="delete-btn" data-id="{{ user[0] }}" onclick="openDeleteModal('{{ user[0] }}')">
                                        <i class="fas fa-trash"></i>Delete
                            </button>                                   
                               
                            </td>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </section>
    </div>

    
<!-- Update users Form Modal -->
<div id="update-user-modal" class="modal"> 
    <div class="modal-content">
        <span class="close-btn">&times;</span>
        <h2 class="form-title">Edit User</h2>
  
  
        <form action="{{ url_for('admin.update_user') }}" method="POST" class="form">
            <input type="hidden" name="user_id" id="user-id">
            
            <!-- Username Field -->
            <div class="form-group">
                <label class="form-label" for="username">Username</label>
                <input type="text" name="username" id="username" class="form-input" required>
            </div>
            
            <!-- Email Field -->
            <div class="form-group">
                <label class="form-label" for="email">Email</label>
                <input type="email" name="email" id="email" class="form-input" required>
            </div>
            
            <!-- Phone Field -->
            <div class="form-group">
                <label class="form-label" for="phone">Phone</label>
                <input type="text" name="phone" id="phone" class="form-input" required>
            </div>
            
          <!-- Status Field -->
            <div class="form-group">
              <label class="form-label" for="status">Status</label>
              <select name="status" id="status" class="form-input" required>
                  <option value="1">Activate Account</option>
                  <option value="0">Deactivate Account</option>
              </select>
            </div>
            
            <!-- Submit Button -->
            <button type="submit" class="form-button">Update</button>
        </form>
    </div>
  </div>

<!--delete user modal-->
  <div id="delete-user-modal" class="modal">
    <div class="modal-content">
        <span class="close-btn">&times;</span>
        <h2 class="form-title">Confirm Delete</h2>
        <p>Are you sure you want to delete this user?</p>
        <form action="{{ url_for('admin.delete_user') }}" method="POST" class="form">
            <input type="hidden" name="user_id" id="delete-user-id">
            <button type="submit" class="form-button danger">Delete</button> <br> <br> <hr> <hr> <br>
            <button type="button" class="form-button" onclick="closeDeleteModal()">Cancel</button>
        </form>
    </div>
</div>


    <script>  
// JavaScript to open modal and populate user details
document.querySelectorAll('.edit-btn').forEach(button => {
    button.addEventListener('click', function() {
        const userId = this.getAttribute('data-id');
        const username = this.getAttribute('data-username');
        const email = this.getAttribute('data-email');
        const phone = this.getAttribute('data-phone');
        const status = this.getAttribute('data-status');
        
        // Set values in the update form
        document.getElementById('user-id').value = userId;
        document.getElementById('username').value = username;
        document.getElementById('email').value = email;
        document.getElementById('phone').value = phone;

        // Set the status select dropdown
        const statusSelect = document.getElementById('status');
        statusSelect.value = status;

        // Open the modal
        document.getElementById('update-user-modal').style.display = 'block';
    });
});

// JavaScript to close the modal when the "X" is clicked
document.querySelector('.close-btn').addEventListener('click', function() {
    document.getElementById('update-user-modal').style.display = 'none';
});

// Optional: Close the modal if user clicks outside the modal content
window.addEventListener('click', function(event) {
    const modal = document.getElementById('update-user-modal');
    if (event.target === modal) {
        modal.style.display = 'none';
    }
});

//delete modal functionality downwards
function openDeleteModal(userId) {
    document.getElementById('delete-user-id').value = userId;
    document.getElementById('delete-user-modal').style.display = 'block';
}

function closeDeleteModal() {
    document.getElementById('delete-user-modal').style.display = 'none';
}

// Close the modal when the "X" is clicked
document.querySelector('#delete-user-modal .close-btn').addEventListener('click', closeDeleteModal);

// Optional: Close the modal if user clicks outside the modal content
window.addEventListener('click', function(event) {
    const modal = document.getElementById('delete-user-modal');
    if (event.target === modal) {
        closeDeleteModal();
    }
});

</script>

</body>
</html>
